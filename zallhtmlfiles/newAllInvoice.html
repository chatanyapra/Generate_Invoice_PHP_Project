<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Invoices - GST Invoice Generator</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome (for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Custom styles to match the design */
        body {
            background-color: #f0f2f5;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 0.3em 0.8em;
            margin-left: 2px;
            border-radius: 4px;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.current,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            color: white !important;
            background: #2563eb;
            border-color: #2563eb;
        }
        .dataTables_wrapper .dataTables_info {
            color: #6b7280;
        }
        .dataTables_wrapper .dataTables_filter {
            display: none; /* Hide default search box */
        }
        table.dataTable thead th {
             border-bottom: 1px solid #e5e7eb;
        }
        table.dataTable.no-footer {
            border-bottom: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="font-sans">

    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
        <aside class="w-64 bg-white flex flex-col flex-shrink-0">
            <div class="h-16 flex items-center px-4 border-b border-gray-200">
                 <div class="flex items-center">
                    <div class="bg-blue-600 text-white p-2 rounded-md">
                        <i class="fa-solid fa-file-invoice"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-semibold text-gray-700">J.V. Jewellers</p>
                        <p class="text-xs text-gray-500">GST Invoice Generator</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 overflow-y-auto">
                <ul class="py-4">
                    <li class="px-4 py-2 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-md mx-2">
                        <a href="#" class="flex items-center">
                            <i class="fa-solid fa-table-columns w-6"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="px-4 py-2 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-md mx-2">
                        <a href="#" class="flex items-center">
                            <i class="fa-solid fa-circle-plus w-6"></i>
                            <span>Create Invoice</span>
                        </a>
                    </li>
                    <li class="px-4 py-2 text-blue-600 bg-blue-100 rounded-md mx-2 font-semibold">
                        <a href="#" class="flex items-center">
                            <i class="fa-solid fa-file-invoice w-6"></i>
                            <span>All Invoices</span>
                        </a>
                    </li>
                    <li class="px-4 py-2 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-md mx-2">
                        <a href="#" class="flex items-center">
                            <i class="fa-solid fa-users w-6"></i>
                            <span>Customers</span>
                        </a>
                    </li>
                    <li class="px-4 py-2 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-md mx-2">
                        <a href="#" class="flex items-center">
                            <i class="fa-solid fa-chart-line w-6"></i>
                            <span>Reports</span>
                        </a>
                    </li>
                    <li class="px-4 py-2 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-md mx-2">
                        <a href="#" class="flex items-center">
                            <i class="fa-solid fa-gear w-6"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Top bar -->
            <header class="h-16 bg-white border-b border-gray-200">
                <!-- can add user profile, notifications etc. here -->
            </header>

            <!-- Page content -->
            <div class="flex-1 p-6 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">All Invoices</h1>
                        <p class="text-gray-500">View, filter, and manage your invoices</p>
                    </div>
                    <button id="createInvoiceBtn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center">
                        <i class="fa-solid fa-plus mr-2"></i> Create New Invoice
                    </button>
                </div>

                <!-- Filters and Table -->
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <!-- Filter Controls -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label for="customSearch" class="block text-sm font-medium text-gray-700">Search</label>
                            <input type="text" id="customSearch" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Search by customer, invoice#...">
                        </div>
                        <div>
                            <label for="transactionType" class="block text-sm font-medium text-gray-700">Transaction Type</label>
                            <select id="transactionType" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                <option>Retail Sales</option>
                                <option>Wholesale</option>
                                <option>Returns</option>
                            </select>
                        </div>
                        <div>
                            <label for="dateRange" class="block text-sm font-medium text-gray-700">Date Range</label>
                            <select id="dateRange" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                <option>Last 7 Days</option>
                                <option>Last 30 Days</option>
                                <option>This Month</option>
                                <option>All Time</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="clearFiltersBtn" class="w-full bg-white text-gray-700 px-4 py-2 rounded-md border border-gray-300 hover:bg-gray-50 flex items-center justify-center">
                                <i class="fa-solid fa-arrows-rotate mr-2"></i> Clear Filters
                            </button>
                        </div>
                    </div>
                    
                    <!-- DataTable -->
                    <div class="overflow-x-auto">
                        <table id="invoicesTable" class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Invoice No.</th>
                                    <th scope="col" class="px-6 py-3">Date</th>
                                    <th scope="col" class="px-6 py-3">Customer</th>
                                    <th scope="col" class="px-6 py-3">Type</th>
                                    <th scope="col" class="px-6 py-3">Amount</th>
                                    <th scope="col" class="px-6 py-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be populated by DataTables -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
$(document).ready(function() {
    // Dummy Data
    const dummyData = [
        { id: 1, invoice_no: 'INV-00123', date: '2023-11-21', customer: 'John Doe', type: 'Retail Sales', amount: '1,250.00' },
        { id: 2, invoice_no: 'INV-00124', date: '2023-11-22', customer: 'Jane Smith', type: 'Retail Sales', amount: '2,400.50' },
        { id: 3, invoice_no: 'INV-00125', date: '2023-11-23', customer: 'Peter Jones', type: 'Wholesale', amount: '15,750.00' },
        { id: 4, invoice_no: 'INV-00126', date: '2023-11-24', customer: 'Mary Johnson', type: 'Retail Sales', amount: '850.75' },
        { id: 5, invoice_no: 'INV-00127', date: '2023-11-25', customer: 'David Williams', type: 'Returns', amount: '-300.00' },
        { id: 6, invoice_no: 'INV-00128', date: '2023-11-26', customer: 'Sarah Brown', type: 'Retail Sales', amount: '5,600.00' },
        { id: 7, invoice_no: 'INV-00129', date: '2023-11-27', customer: 'Chris Davis', type: 'Wholesale', amount: '22,100.20' },
        { id: 8, invoice_no: 'INV-00130', date: '2023-11-28', customer: 'Mercedes Lane', type: 'Retail Sales', amount: '990.00' }
    ];

    // Initialize DataTable
    const table = $('#invoicesTable').DataTable({
        data: dummyData,
        columns: [
            { data: 'invoice_no' },
            { data: 'date' },
            { data: 'customer' },
            { data: 'type' },
            { data: 'amount', className: 'text-right' },
            {
                data: null,
                className: 'text-center',
                orderable: false,
                searchable: false,
                render: function(data, type, row) {
                    return `
                        <button class="text-blue-600 hover:text-blue-800 p-1 edit-btn" title="Edit">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-800 p-1 delete-btn" title="Delete">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;
                }
            }
        ],
        "dom": '<"top">rt<"bottom flex justify-between items-center mt-4"ip><"clear">',
        "language": {
            "zeroRecords": "No invoices found matching your filters",
            "info": "Showing _START_ to _END_ of _TOTAL_ entries",
            "infoEmpty": "Showing 0 to 0 of 0 entries",
            "infoFiltered": "(filtered from _MAX_ total entries)",
        }
    });

    // Custom Search Functionality
    $('#customSearch').on('keyup', function() {
        table.search(this.value).draw();
    });
    
    // Clear Filters
    $('#clearFiltersBtn').on('click', function() {
        $('#customSearch').val('');
        $('#transactionType').prop('selectedIndex', 0);
        $('#dateRange').prop('selectedIndex', 0);
        table.search('').columns().search('').draw();
    });

    // Handle Delete Action
    $('#invoicesTable tbody').on('click', '.delete-btn', function() {
        const row = table.row($(this).parents('tr'));
        const rowData = row.data();

        Swal.fire({
            title: 'Are you sure?',
            text: `You are about to delete invoice ${rowData.invoice_no}. You won't be able to revert this!`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                row.remove().draw();
                Swal.fire(
                    'Deleted!',
                    `Invoice ${rowData.invoice_no} has been deleted.`,
                    'success'
                )
            }
        })
    });

    // Handle Edit Action
    $('#invoicesTable tbody').on('click', '.edit-btn', function() {
        const rowData = table.row($(this).parents('tr')).data();
        Swal.fire({
          title: 'Edit Invoice',
          text: `You clicked edit for invoice ${rowData.invoice_no}. A full form would go here.`,
          icon: 'info'
        });
    });

    // Handle Create New Invoice
    $('#createInvoiceBtn').on('click', function() {
        Swal.fire({
            title: 'Create New Invoice',
            html: `
                <input id="swal-invoice-no" class="swal2-input" placeholder="Invoice No. (e.g., INV-00131)">
                <input id="swal-customer" class="swal2-input" placeholder="Customer Name">
                <input id="swal-amount" class="swal2-input" placeholder="Amount" type="number">
                <select id="swal-type" class="swal2-input">
                    <option value="Retail Sales">Retail Sales</option>
                    <option value="Wholesale">Wholesale</option>
                    <option value="Returns">Returns</option>
                </select>
            `,
            confirmButtonText: 'Add Invoice',
            focusConfirm: false,
            preConfirm: () => {
                const invoiceNo = document.getElementById('swal-invoice-no').value;
                const customer = document.getElementById('swal-customer').value;
                const amount = document.getElementById('swal-amount').value;
                if (!invoiceNo || !customer || !amount) {
                    Swal.showValidationMessage(`Please fill out all fields`);
                }
                return { invoiceNo, customer, amount, type: document.getElementById('swal-type').value };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const today = new Date().toISOString().slice(0, 10);
                const newId = Math.max(...dummyData.map(d => d.id)) + 1;

                // Add data to DataTable
                table.row.add({
                    id: newId,
                    invoice_no: result.value.invoiceNo,
                    date: today,
                    customer: result.value.customer,
                    type: result.value.type,
                    amount: parseFloat(result.value.amount).toFixed(2)
                }).draw(false);
                
                // Also add to original data source if needed for consistency
                dummyData.push({
                     id: newId,
                    invoice_no: result.value.invoiceNo,
                    date: today,
                    customer: result.value.customer,
                    type: result.value.type,
                    amount: parseFloat(result.value.amount).toFixed(2)
                });

                Swal.fire('Success!', 'New invoice has been added.', 'success');
            }
        });
    });

});
</script>

</body>
</html>